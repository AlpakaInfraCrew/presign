{% extends "control/base.html" %}
{% load django_bootstrap5 %}
{% load control_helpers %}
{% load i18n %}

{% block content %}
    <h1>
        {% trans "Participant Details" %}
        <div class="badge rounded-pill text-bg-{{ state_settings|get_value:participant.state|get_value:"pill_color" }} float-end">
            <span class="visually-hidden">{% trans "Participant status:" %}</span>{{ participant.get_state_display }}
        </div>
    </h1>
    <div class="clearfix">
        <div class="btn-group py-3 float-start"
             role="group"
             aria-label="Change participant status">
            <a role="button"
               class="btn btn-secondary"
               href="{% url "signup:participant-details" event=participant.event.slug organizer=participant.event.organizer.slug code=participant.code secret=participant.secret %}">{% trans "View as User" %}</a>

            {% for state_change in state_settings|get_value:participant.state|get_value:"transition_buttons" %}
                {% with state_change_strings|get_value:state_change as btn_config %}
                    <a role="button"
                       class="btn btn-{{ btn_config.btn_type }}"
                       href="{% url "control:participant-change" state_change=state_change event=participant.event.slug organizer=participant.event.organizer.slug code=participant.code %}">{{ btn_config.btn_text }}</a>
                {% endwith %}
            {% endfor %}

        </div>
    </div>

    <section class="card mb-3">
        <div class="card-header">{% trans "Internal Information" %}</div>
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                {% bootstrap_form form %}
                <button class="btn btn-primary float-end" type="submit">{% trans "Save" %}</button>
            </form>
        </div>
    </section>
 
    {% include "./_participant_answers.html" %}

    <section class="card mb-3">
        <div class="card-header">{% trans "Events" %}</div>
        <ul class="list-group list-group-flush">
            {% for event in participant.log_events.all %}
                <li class="list-group-item">
                    <div class="row">
                        <div class="col-lg-2 col-sm-6 col-xs-12">{{ event.datetime|date:"SHORT_DATETIME_FORMAT" }}</div>
                        <div class="col-lg-6 col-sm-12 col-xs-12">{{ event.display }}</div>
                        {% if request.user.is_staff %}
                            <div class="col-12">
                                <details>
                                    <summary>Show raw event data</summary>
                                    <code>
                                        {{ event.data }}
                                    </code>
                                </details>
                            </div>
                        {% endif %}
                    </div>
                </li>
            {% endfor %}
        </ul>
    </section>
{% endblock content %}
